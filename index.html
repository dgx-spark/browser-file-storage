<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern File Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <div class="login-title">$ FILE_MANAGER</div>
                <div class="login-subtitle">// ACCESS CONTROL SYSTEM</div>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form" onsubmit="handleLogin(event)">
                <div id="loginMessage" class="auth-message" style="display: none;"></div>
                <div class="form-group">
                    <label class="form-label">$ USERNAME:</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="enter_username" required autocomplete="username">
                    <div class="field-error" id="loginUsernameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">$ PASSWORD:</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="enter_password" required autocomplete="current-password">
                    <div class="field-error" id="loginPasswordError"></div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                    [ENTER] LOGIN
                </button>
                <div style="text-align: center; margin-top: 15px;">
                    <a class="auth-toggle-link" onclick="showForgotPasswordModal()" style="font-size: 11px;">
                        [FORGOT PASSWORD?]
                    </a>
                </div>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)" style="display: none;">
                <div id="registerMessage" class="auth-message" style="display: none;"></div>
                <div class="form-group">
                    <label class="form-label">$ USERNAME:</label>
                    <input type="text" class="form-input" id="registerUsername" placeholder="choose_username" required autocomplete="username">
                    <div class="field-error" id="registerUsernameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">$ EMAIL:</label>
                    <input type="email" class="form-input" id="registerEmail" placeholder="enter_email" required autocomplete="email">
                    <div class="field-error" id="registerEmailError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">$ PASSWORD:</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="choose_password" required autocomplete="new-password">
                    <div class="field-error" id="registerPasswordError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">$ CONFIRM PASSWORD:</label>
                    <input type="password" class="form-input" id="registerConfirmPassword" placeholder="confirm_password" required autocomplete="new-password">
                    <div class="field-error" id="registerConfirmPasswordError"></div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                    [ENTER] REGISTER
                </button>
            </form>

            <div class="auth-toggle">
                <span style="color: rgba(0, 255, 0, 0.7); font-size: 12px;">
                    <span id="toggleText">// NEW USER?</span>
                    <a class="auth-toggle-link" onclick="toggleAuthForm()">
                        <span id="toggleLink">[REGISTER]</span>
                    </a>
                </span>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" style="display: none;">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="btn btn-secondary" onclick="toggleMobileSidebar()" id="mobileMenuBtn" style="display: none;">
                [‚ò∞] MENU
            </button>
            <h1>$ FILE_MANAGER_V1.0</h1>
            <div class="header-actions">
                <div id="userInfo" style="margin-right: 20px;"></div>
                <button class="btn btn-primary" onclick="showUploadModal()">
                    [‚Üë] UPLOAD
                </button>
                <button class="btn btn-secondary" onclick="showNewFolderModal()">
                    [+] NEW_DIR
                </button>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <div class="breadcrumb" id="breadcrumb">
                <div class="breadcrumb-item" onclick="navigateTo('home')">~/ HOME</div>
            </div>
            <input type="text" class="search-box" placeholder="$ search..." id="searchBox" oninput="searchFiles()">
            <div class="view-controls">
                <button class="view-btn active" onclick="setView('grid')" id="gridBtn">[GRID]</button>
                <button class="view-btn" onclick="setView('list')" id="listBtn">[LIST]</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Mobile Sidebar Overlay -->
            <div id="sidebarOverlay" class="sidebar-overlay" onclick="closeMobileSidebar()" style="display: none;"></div>
            
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">// QUICK ACCESS</div>
                    <div class="sidebar-item active" onclick="filterByType('all')">
                        > ALL FILES
                    </div>
                    <div class="sidebar-item" onclick="filterByType('recent')">
                        > RECENT
                    </div>
                    <div class="sidebar-item" onclick="filterByType('starred')">
                        > STARRED
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">// FILE TYPES</div>
                    <div class="sidebar-item" onclick="filterByType('image')">
                        > IMAGES
                    </div>
                    <div class="sidebar-item" onclick="filterByType('document')">
                        > DOCUMENTS
                    </div>
                    <div class="sidebar-item" onclick="filterByType('video')">
                        > VIDEOS
                    </div>
                    <div class="sidebar-item" onclick="filterByType('audio')">
                        > AUDIO
                    </div>
                </div>

                <div class="storage-info">
                    <div class="storage-text">// STORAGE USED</div>
                    <div class="storage-bar">
                        <div class="storage-fill" style="width: 0%"></div>
                    </div>
                    <div class="storage-text">0 B / 5 GB</div>
                </div>
            </div>

            <!-- File Area -->
            <div class="file-area">
                <div class="file-grid" id="fileArea">
                    <!-- Files will be populated here by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Status Indicator -->
    <div class="status-indicator" id="statusIndicator">
        <span id="statusIcon">‚úì</span>
        <span id="statusText">Saved to database</span>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="openFile()">> OPEN</div>
        <div class="context-menu-item" onclick="renameFile()">> RENAME</div>
        <div class="context-menu-item" onclick="downloadFile()">> DOWNLOAD</div>
        <div class="context-menu-item" onclick="toggleStar()">> STAR</div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" onclick="deleteFile()">> DELETE</div>
    </div>

    <!-- Upload Modal -->
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <div class="modal-header">// UPLOAD FILES</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">$ SELECT FILES:</label>
                    <input type="file" class="form-input" id="fileInput" multiple>
                </div>
                
                <!-- Upload Progress Section -->
                <div id="uploadProgressSection" style="display: none; margin-top: 20px;">
                    <div style="border: 1px solid rgba(0, 255, 0, 0.3); padding: 15px; background: rgba(0, 255, 0, 0.05);">
                        <div style="font-size: 12px; font-weight: 700; color: #00ff00; margin-bottom: 10px;">
                            // UPLOAD PROGRESS
                        </div>
                        
                        <div id="currentFileInfo" style="font-size: 11px; margin-bottom: 10px; color: rgba(0, 255, 0, 0.8);">
                            <span id="currentFileName"></span>
                        </div>
                        
                        <div style="background: #000; border: 1px solid #00ff00; height: 30px; position: relative; overflow: hidden;">
                            <div id="uploadProgressBar" style="background: linear-gradient(90deg, #00ff00, #00cc00); height: 100%; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center;">
                                <span id="uploadProgressText" style="position: relative; z-index: 1; color: #000; font-weight: 700; font-size: 12px; mix-blend-mode: difference;">0%</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 10px; color: rgba(0, 255, 0, 0.7);">
                            <span id="uploadStats">0 / 0 files</span>
                            <span id="uploadSpeed">0 KB/s</span>
                        </div>
                        
                        <div id="uploadStatus" style="margin-top: 10px; font-size: 11px; color: #00ffff;">
                            // PREPARING FILES...
                        </div>
                        
                        <div id="integrityCheck" style="display: none; margin-top: 10px; padding: 8px; background: rgba(0, 255, 255, 0.1); border: 1px solid rgba(0, 255, 255, 0.3); font-size: 10px; color: #00ffff;">
                            ‚úì VERIFYING FILE INTEGRITY...
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('uploadModal')" id="uploadCancelBtn">[ESC]</button>
                <button class="btn btn-primary" onclick="uploadFiles()" id="uploadBtn">[ENTER]</button>
            </div>
        </div>
    </div>

    <!-- New Folder Modal -->
    <div class="modal" id="newFolderModal">
        <div class="modal-content">
            <div class="modal-header">// CREATE DIRECTORY</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">$ DIR NAME:</label>
                    <input type="text" class="form-input" id="folderNameInput" placeholder="enter_directory_name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('newFolderModal')">[ESC]</button>
                <button class="btn btn-primary" onclick="createFolder()">[ENTER]</button>
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div class="modal" id="renameModal">
        <div class="modal-content">
            <div class="modal-header">// RENAME FILE</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">$ NEW NAME:</label>
                    <input type="text" class="form-input" id="renameInput" placeholder="enter_new_name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('renameModal')">[ESC]</button>
                <button class="btn btn-primary" onclick="confirmRename()">[ENTER]</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="modal" id="adminPanel">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">// ADMIN CONTROL PANEL</div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div id="adminStats"></div>
                <div style="border-top: 1px solid rgba(0, 255, 0, 0.3); padding-top: 15px; margin-top: 15px; margin-bottom: 15px;">
                    <div style="font-size: 13px; font-weight: 700; color: #00ff00; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px;">
                        // DATA MANAGEMENT
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="exportAllData()" style="padding: 8px 15px; font-size: 11px;">
                            [‚Üì] EXPORT ALL DATA
                        </button>
                        <button class="btn btn-secondary" onclick="importAllData()" style="padding: 8px 15px; font-size: 11px;">
                            [‚Üë] IMPORT DATA
                        </button>
                        <button class="btn btn-cancel" onclick="clearAllData()" style="padding: 8px 15px; font-size: 11px;">
                            [√ó] CLEAR ALL DATA
                        </button>
                    </div>
                    <div style="font-size: 10px; color: rgba(0, 255, 0, 0.6); margin-top: 8px;">
                        // EXPORT/IMPORT INCLUDES: USERS, SESSIONS, SETTINGS, AND FILES
                    </div>
                </div>
                <div style="border-top: 1px solid rgba(0, 255, 0, 0.3); padding-top: 15px; margin-top: 15px;">
                    <div style="font-size: 13px; font-weight: 700; color: #00ff00; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 2px;">
                        // USER MANAGEMENT
                    </div>
                    <div id="adminUsersList"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('adminPanel')">[CLOSE]</button>
            </div>
        </div>
    </div>

    <!-- Change Admin Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">// CHANGE ADMIN PASSWORD</div>
            <div class="modal-body">
                <div id="changePasswordMessage" class="auth-message" style="display: none;"></div>
                <div class="form-group">
                    <label class="form-label">$ CURRENT PASSWORD:</label>
                    <input type="password" class="form-input" id="currentPassword" placeholder="enter_current_password" autocomplete="current-password">
                    <div class="field-error" id="currentPasswordError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">$ NEW PASSWORD:</label>
                    <input type="password" class="form-input" id="newPassword" placeholder="enter_new_password" autocomplete="new-password">
                    <div class="field-error" id="newPasswordError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">$ CONFIRM NEW PASSWORD:</label>
                    <input type="password" class="form-input" id="confirmNewPassword" placeholder="confirm_new_password" autocomplete="new-password">
                    <div class="field-error" id="confirmNewPasswordError"></div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: rgba(255, 165, 0, 0.1); border: 1px solid rgba(255, 165, 0, 0.3); font-size: 11px; color: rgba(255, 165, 0, 0.8);">
                    ‚ö†Ô∏è WARNING: CHANGING YOUR PASSWORD WILL LOG YOU OUT. YOU WILL NEED TO LOGIN AGAIN WITH THE NEW PASSWORD.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeChangePasswordModal()">[ESC] CANCEL</button>
                <button class="btn btn-primary" onclick="confirmChangePassword()">[ENTER] CHANGE PASSWORD</button>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal" id="forgotPasswordModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">// PASSWORD RECOVERY</div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div id="forgotPasswordMessage" class="auth-message" style="display: none;"></div>
                
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(0, 255, 255, 0.1); border: 1px solid rgba(0, 255, 255, 0.3); font-size: 12px; color: rgba(0, 255, 255, 0.9);">
                    <div style="font-weight: 700; margin-bottom: 8px;">üìã PASSWORD RECOVERY:</div>
                    <div style="line-height: 1.6;">
                        <strong style="color: #ff0000;">‚ö†Ô∏è ADMIN PASSWORD RECOVERY:</strong><br/>
                        ‚Ä¢ If you forgot admin password, you MUST use data export/import<br/>
                        ‚Ä¢ Only option: Clear all data and start fresh (lose everything)<br/>
                        ‚Ä¢ Or: Import a previous backup if you have one<br/><br/>
                        
                        <strong>FOR REGULAR USERS ONLY:</strong><br/>
                        ‚Ä¢ Click "Generate Recovery Code" button below<br/>
                        ‚Ä¢ Check browser console (F12) for your code<br/>
                        ‚Ä¢ Code is specific to your username<br/>
                        ‚Ä¢ Expires in 10 minutes<br/><br/>
                        
                        <strong style="color: #ffaa00;">ÔøΩ IMPORTANT:</strong><br/>
                        ‚Ä¢ Regular users can reset their passwords with recovery codes<br/>
                        ‚Ä¢ Admin password cannot be recovered (security by design)<br/>
                        ‚Ä¢ Always export backups to prevent lockouts
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">$ USERNAME:</label>
                    <input type="text" class="form-input" id="recoveryUsername" placeholder="enter_username" value="admin">
                    <div class="field-error" id="recoveryUsernameError"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">$ RECOVERY CODE:</label>
                    <input type="text" class="form-input" id="recoveryCode" placeholder="enter_recovery_code" style="text-transform: uppercase;">
                    <div class="field-error" id="recoveryCodeError"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">$ NEW PASSWORD:</label>
                    <input type="password" class="form-input" id="recoveryNewPassword" placeholder="enter_new_password">
                    <div class="field-error" id="recoveryNewPasswordError"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">$ CONFIRM NEW PASSWORD:</label>
                    <input type="password" class="form-input" id="recoveryConfirmPassword" placeholder="confirm_new_password">
                    <div class="field-error" id="recoveryConfirmPasswordError"></div>
                </div>
                
                <button class="btn btn-secondary" onclick="generateRecoveryCode()" style="width: 100%; justify-content: center; margin-top: 10px;">
                    [üîë] GENERATE RECOVERY CODE (CHECK CONSOLE)
                </button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeForgotPasswordModal()">[ESC] CANCEL</button>
                <button class="btn btn-primary" onclick="confirmPasswordRecovery()">[ENTER] RESET PASSWORD</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="handleImportFile(event)">

    <!-- JavaScript -->
    <script src="app.js"></script>
</body>
</html>
